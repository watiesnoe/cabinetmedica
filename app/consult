<div class="card">
                                                <div class="card-inner">
                                                    <div class="tab-content">

                                                        <div class="tab-pane " id="diagnostique">
                                                            <form action="#"  method="post" id="form_traitement" class="form-validate is-alter">

                                                                <div class='row g-gs'>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Adresse patient</label>
                                                                            <input type="text"
                                                                                   class="form-control" name="adresse_patient" id="" aria-describedby="helpId" placeholder="">
                                                                            <input type="text"
                                                                                   class="form-control" name="idpatient" id="" aria-describedby="helpId" placeholder="" value="<?=$datas->num_patient?>">
                                                                            <input type="text"
                                                                                   class="form-control" name="id" id="" aria-describedby="helpId" placeholder="" value="<?=$id?>">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Telephone</label>
                                                                            <input type="number"
                                                                                   class="form-control" name="telephone" id="" aria-describedby="helpId" placeholder="" >
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Fils de </label>
                                                                            <input type="text"
                                                                                   class="form-control" name="fils" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Genre </label>
                                                                            <select name="genre" id="" class="form-control">
                                                                                <option value="F">Féminin</option>
                                                                                <option value="M">Masculin</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Groupe Sanguin</label>
                                                                            <input type="text"
                                                                                   class="form-control" name="groupesangine" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Stuation Matrimonial</label>
                                                                            <input type="text"
                                                                                   class="form-control" name="stuation_matrimonial" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Ethnie du patient</label>
                                                                            <input type="text"
                                                                                   class="form-control" name="ethinie" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Poids</label>
                                                                            <input type="number"
                                                                                   class="form-control" name="poids" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Taille</label>
                                                                            <input type="number"
                                                                                   class="form-control" name="taille" id="" aria-describedby="helpId" placeholder="">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Motif de la consultation</label>
                                                                            <textarea name="motif_consultation" id="" cols="10" rows="5" class="form-control"></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4"">
                                                                        <div class="form-group">
                                                                            <label for="">Diagnostique</label>
                                                                            <textarea name="diagnostique" id="" cols="10" rows="5" class="form-control"></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="">Resultat du bilan de l'examen clinique</label>
                                                                            <textarea name="resultat_clinique" id="" cols="10" rows="5" class="form-control"></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6"">
                                                                        <div class="form-group">
                                                                            <label for="">Antecedant Medicaux</label>
                                                                            <textarea name="diagnostique" id="" cols="10" rows="5" class="form-control"></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6"">
                                                                        <div class="form-group">
                                                                            <label for="form-label">Antecedant Chirigicaux</label>
                                                                            <div class="form-control-wrap">
                                                                                 <textarea name="resultat_clinique" id="" cols="10" rows="5" class="form-control"></textarea>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <div class="form-group"  align="right">
                                                                            <button type="submit" class="btn btn-lg btn-primary" name="envoyer" id="envoyer">Save Informations</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>




<!DOCTYPE html>
<html>
<?php $this->view('common/header')?>
<body data-background-color="">
<div class="wrapper">
    <div class="main-header">
        <?php $this->view('common/navbare'); ?>
        <!-- Navbar Header -->
        <!-- End Navbar -->
    </div>
    <!-- Sidebar -->
    <?php $this->view('common/sidebare'); ?>
    <!-- End Sidebar -->
    <!-- contenu principale-->
    <div class="main-panel">

        <div class="content">
            <!-- Row Card No Padding -->
            <div class="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <h4 class="card-title">Voir la liste des maladies</h4>
                                    <a class="btn btn-primary btn-round ml-auto" href="<?=ROOT?>/Tickets/liste">
                                        <i class="fas fa-plus"></i>
                                        Lister
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Modal ajout de salle -->
                                <?php $this->view('common/_flash')?>

                                <?php if (isset($id)) : ?>
                                    <?php foreach ($patients as $patient) : ?>
                                            <?php if ($patient->num_patient === $ticket->idPatient and $ticket->statut_ticket===null and $ticket->idUt===$_SESSION['user_id']) : ?>
                                                <form action="" method="post" id="postTicketData">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <input type="hidden" class="form-control" id="idTicket" name="idTicket" placeholder="" value="<?=$ticket->num_ticket ?>">
                                                                <label for="ticket">Type du ticket</label>
                                                                <select name="typeTicket" id="ticket" class="form-control">
                                                                    <option >Selectionner le type de ticket</option>
                                                                    <option value="consulation"<?=$ticket->type_ticket==="consulation"?"selected":"" ?>>Consultation
                                                                    </option>
                                                                    <option value="analyse"<?=$ticket->type_ticket==="analyse"?"selected":"" ?>>Analyse </option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="">Date actuelle</label>
                                                                <input type="text" class="form-control" id="dateTicket" name="dateTicket" placeholder="" value="<?=$ticket->date_ticket?>">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="">Frais</label>
                                                                <input type="number" class="form-control" id="frais" name="frais" placeholder="" value="<?=$ticket->frais?>">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label for="">Nom du patient</label>
                                                                <input type="text" class="form-control" id="nomPatient" name="nomPatient" value="<?=$patient->nom_patient?>" placeholder="">
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label for="">Prenom du patient</label>
                                                                <input type="text" class="form-control" id="prenomPatient" name="prenomPatient" value="<?=$patient->prenom_patient?>" placeholder="">
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="form-group">
                                                                <label for="nomStructure">Structure d'attachement </label >

                                                                <select name = "nomStructure" class="form-control nomStructure" id = "nomStructure" >
                                                                    <option value = "" > Choisir votre structure </option > ';
                                                                    <option value="<?=$ticket->codeStructure?>" selected><?=$ticket->nom_structure?></option>
                                                                    <?php  foreach ($structures as $structure):?>
                                                                        <?php if ($structure->num_structure !=$ticket->codeStructure) : ?>
                                                                            <option value="<?=$structure->codeStructure?>"><?=$structure->nom_structure?></option>
                                                                        <?php endif; ?>
                                                                    <?php endforeach; ?>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group">
                                                                <label for="">Age patient</label>
                                                                <input type="text" class="form-control" id="age" name="age" placeholder="" value="<?=$patient->age_patient?>">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">

                                                    </div>
                                                    <div class="row " >
                                                        <?php if($ticket->idCodesociale!=null):?>
                                                            <div class="col-6">
                                                                <fieldset class="form-group">
                                                                    <label for="securite"> <h6>Patient est-il attacher aune securite sociale ? </h6> </label>
                                                                    <input type="checkbox" name="securite" class="securites" style="width: 23px;"   checked id="securites">
                                                                </fieldset>
                                                            </div>
                                                            <div class="col-6 selectedscuriteUpdate">
                                                                <div class="submenu">
                                                                    <?php foreach ($securites as $securite) : ?>
                                                                        <?php if($securite->idSecurite===$ticket->idCodesociale) :?>
                                                                            <div class="form-check">
                                                                                <input class="form-check-input" type="radio" name="pourcentage" checked id="<?=$securite->nom_societe?>" value="<?=$securite->idSecurite?>">
                                                                                <label class="form-check-label" for="<?=$securite->nom_societe?>">
                                                                                    <?=$securite->nom_societe?>
                                                                                </label>
                                                                            </div>
                                                                        <?php endif ?>
                                                                        <?php if($securite->idSecurite!=$ticket->idCodesociale) :?>
                                                                            <div class="form-check">
                                                                                <input class="form-check-input" type="radio" name="pourcentage"   id="<?=$securite->nom_societe?>" value="<?=$securite->idSecurite?>">
                                                                                <label class="form-check-label" for="<?=$securite->nom_societe?>">
                                                                                    <?=$securite->nom_societe?>
                                                                                </label>
                                                                            </div>
                                                                        <?php endif ?>

                                                                    <?php endforeach; ?>
                                                                    <div class="form-check">
                                                                        <input type="radio" value="editautre" id="editautre" name="pourcentage"  class="editautre form-check-input">
                                                                        <label class="form-check-label" for="editautre">
                                                                            Autre
                                                                        </label>
                                                                        <div class="edit_pourcentage">
                                                                            <label for="champ">Entrer le  pourcentage</label>
                                                                            <input type="number" value="" class="form-control col-4 champ"  name="champ"   id="champ" >
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        <?php elseif($ticket->autre!=null) :?>
                                                            <div class="col-12">
                                                                <fieldset class="form-group">
                                                                    <label for="securite"> <h6>Patient est-il attacher aune securite sociale ? </h6> </label>
                                                                    <input type="checkbox" name="securite" class="securites" style="width: 23px;"   checked id="securites">
                                                                </fieldset>
                                                            </div>
                                                             <div class="col-10 m-4 selectedscuriteUpdate">
                                                            <?php foreach ($securites as $securite) : ?>
                                                                <?php if($securite->idSecurite===$ticket->idCodesociale) :?>
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="radio" name="pourcentage"  id="<?=$securite->nom_societe?>" value="<?=$securite->idSecurite?>">
                                                                        <label class="form-check-label" for="<?=$securite->nom_societe?>">
                                                                            <?=$securite->nom_societe?>
                                                                        </label>
                                                                    </div>
                                                                <?php endif ?>
                                                                <?php if($securite->idSecurite!=$ticket->idCodesociale) :?>
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="radio" name="pourcentage"   id="<?=$securite->nom_societe?>" value="<?=$securite->idSecurite?>">
                                                                        <label class="form-check-label" for="<?=$securite->nom_societe?>">
                                                                            <?=$securite->nom_societe?>
                                                                        </label>
                                                                    </div>
                                                                <?php endif ?>

                                                            <?php endforeach; ?>
                                                            <div class="form-check">
                                                                <input type="radio" value="editautre" id="editautre" name="pourcentage" checked class="editautre form-check-input">
                                                                <label class="form-check-label" for="editautre">
                                                                    Autre
                                                                </label>
                                                                <div class="">
                                                                    <label for="champ">Entrer le  pourcentage</label>
                                                                    <input type="number" value="<?=$ticket->autre?>" class="form-control col-4 champ"  name="champ"   id="champ" >
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <?php else:?>
                                                            <div class="col-12">
                                                                <fieldset class="form-group">
                                                                    <label for="securite"> <h6>Patient est-il attacher aune securite sociale ? </h6> </label>
                                                                    <input type="checkbox" name="securite" class="editsecurites" style="width: 23px;" id="editsecurites">
                                                                </fieldset>
                                                            </div>
                                                            <div class="col-12 selectedscuriteUpdate m-4">
                                                                <?php foreach ($securites as $securite) : ?>
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="radio" name="pourcentage" checked id="<?=$securite->nom_societe?>" value="<?=$securite->idSecurite?>">
                                                                        <label class="form-check-label" for="<?=$securite->nom_societe?>">
                                                                            <?=$securite->nom_societe?>
                                                                        </label>
                                                                    </div>
                                                                <?php endforeach; ?>
                                                                <div class="form-check">
                                                                    <input type="radio" value="editautre" id="editautre" name="pourcentage"  class="editautre form-check-input">
                                                                    <label class="form-check-label" for="editautre">
                                                                        Autre
                                                                    </label>
                                                                    <div class="edit_pourcentage">
                                                                        <label for="champ">Entrer le  pourcentage</label>
                                                                        <input type="number" value="" class="form-control col-4 champ"  name="champ"   id="champ" >
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        <?php endif;?>
                                                    </div>
                                                    <input type="submit" class="btn btn-outline-primary fa-pull-right" name="envoyer"  value= "Enregistrer">
                                                </form>
                                            <?php endif; ?>
                                        <?php endforeach; ?>
                                    <?php else: ?>
                                        <form action="" method="post" id="postTicketData">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="ticket">Type du ticket</label>
                                                        <select name="typeTicket" id="ticket" class="form-control">
                                                            <option >Selectionner le type de ticket</option>
                                                            <option value="consulation" selected>Consultation </option>
                                                            <option value="analyse">Analyse </option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="">Date actuelle</label>
                                                        <input type="text" class="form-control" id="dateTicket" name="dateTicket" placeholder="" value="<?=date
                                                        ('Y-m-d H:m:s') ?>">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="">Frais</label>
                                                        <input type="number" class="form-control" id="frais" name="frais" placeholder="" value="">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="">Nom du patient</label>
                                                        <input type="text" class="form-control" id="nomPatient" name="nomPatient" value="" placeholder="">
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="">Prenom du patient</label>
                                                        <input type="text" class="form-control" id="prenomPatient" name="prenomPatient" value="" placeholder="">
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="form-group">
                                                        <label for="nomStructure">Structure d'attachement </label >

                                                        <select name = "nomStructure" class="form-control nomStructure" id = "nomStructure" >
                                                            <option value = "" > Choisir votre structure </option > ';
                                                            <?= $structure?>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label for="">Age patient</label>
                                                        <input type="text" class="form-control" id="age" name="age" placeholder="" value="">
                                                    </div>
                                                </div>
                                            </div> <div class="row">
                                                <div class="col-4">
                                                    <fieldset class="form-group">
                                                        <label for="securite"> <h6>Patient est-il attacher aune securite sociale ? </h6> </label>
                                                        <input type="checkbox" name="securite" class="securite" style="width: 23px;"  id="securite">
                                                    </fieldset>
                                                </div>
                                            </div>
                                            <div class="row selectedscurite" >


                                            </div>

                                            <input type="submit" class="btn btn-outline-primary fa-pull-right" name="envoyer"  value= "Enregistrer">
                                        </form>
                                    <?php endif ?>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TimeLine -->
        </div>
        <?php $this->view('common/foot'); ?>
    </div>
    <!-- End Custom template -->
</div>

<!--   Core JS Files   -->
<?php $this->view('common/footer'); ?>
<script>
    $(document).ready(function(){
        var count=0;
        jQuery('#securite').change(function() {
            if ($(this).prop('checked')) {
                count++;
                selectedHospitaliser();
                $('.autre_pourcentage').hide();
                $('input:radio[name="pourcantage"]').change(function(){
                    if (this.checked && this.value === 'autre') {
                       $('.autre_pourcentage').show();
                    }else {
                        $('.autre_pourcentage').hide();
                    }
                });
            }else {
                $('.selectedscurite').find('.submenu').remove();
            }
        });

        function selectedHospitaliser() {
            var input = '<div class="col-lg-4 submenu" id="submenu"><?=$datasecurite?></div>';
            $('.selectedscurite').html(input);
        }
    });

</script>
<script>
    $('.edit_pourcentage').hide();
    $('.selectedscuriteUpdate').hide();
    if ($('.securites').prop('checked')) {
        $('.selectedscuriteUpdate').show();
        $('input:radio[name="pourcentage"]').change(function(){

            if (this.checked && this.value === 'editautre') {

                $('.edit_pourcentage').show();

            }else {

                $('.edit_pourcentage').hide();
            }
        });

    }else {

    }
</script>
<script>
    $('.edit_pourcentage').hide();

    jQuery('#editsecurites').change(function() {
        if ($(this).prop('checked')) {

            $('.selectedscuriteUpdate').show();
            $('input:radio[name="pourcentage"]').change(function(){

                if (this.checked && this.value === 'editautre') {

                    $('.edit_pourcentage').show();

                }else {

                    $('.edit_pourcentage').hide();
                }
            });
        }else {
            $('.selectedscuriteUpdate').hide();
        }
    });
</script>
</body>
</html>
<?php
/**
 * Created by PhpStorm.
 * User: SNT
 * Date: 27/03/2023
 * Time: 08:13
 */

class Consultation extends Model
{
 public $errors=[];

    public function verificationConsultation($champ = [])
    {
        $bdd=$this->bdd();

        if ($this->VerifyFields($champ)){

            $this->e(extract($_POST));

            /*$this->chekErrorsString($nomPatient,5,"Le champ nom doit avoir plus de 4 caracteur");*/
            /*    $this->chekErrorsInt($telephone,"Le champs telephone doit etre un entier");*/



               

                $this->chekErrorsInt($telephone,8,"Le numero de telephone doit comporter 8 chiffre");

                if (isset($taillePat)){

                    if($taillePat>=3 and $taillePat<1){
                        $this->errors[]="La taille doit etre inférieur à trois";
                    }
                    $this->chekErrorsString($poids,"Le poids doit être en chifre ");

                }
                if (isset($antecedant_traite)  and isset($habitude) and isset($antecedant_famil) and isset($antecedant_personnel)) {
 
                     echo $antecedant_traite."<br>";
                     echo $habitude."<br>";
                     echo $antecedant_famil."<br>";
                     echo $antecedant_personnel."<br>";
                     echo $adresse_patient."<br>";
                     echo $telephone."<br>";
                     echo $fils."<br>";
                     echo $genre."<br>";
                     echo $groupesangine."<br>";
                     echo $stuation_matrimonial."<br>";
                     echo $ethinie."<br>";
                     echo $poids."<br>";
                     echo $taille."<br>";
                     echo $motif_consultation."<br>";
                     echo $diagnostique."<br>";
                     echo $resultat_clinique."<br>";
                     echo $remarque."<br>";
                     echo $description."<br>";
                     echo $antecedant_famil."<br>";
                     echo $antecedant_mifa."<br>";
                     echo $antecedant_personnelle."<br>";
                     echo $observation."<br>";
                     echo $pathologie."<br>";
                     echo $traitement_en_cours."<br>";
                     echo $date_debut."<br>";
                     echo $dure."<br>";
                } else if(isset($antecedant_traite)  and isset($habitude) and isset($antecedant_famil)){

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $membre_famille."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if(isset($antecedant_traite)  and isset($habitude) ){

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if(isset($habitude) and isset($antecedant_famil) and isset($antecedant_personnel)){

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if(isset($habitude) and isset($antecedant_famil)){
                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_personnel."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if (isset($antecedant_traite) and isset($antecedant_personnel)) {

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_personnel."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if(isset($habitude) and isset($antecedant_famil)){

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_personnel."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if(isset($antecedant_traite) and isset($antecedant_famil)){

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_personnel."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                }
                else if (isset($antecedant_famil) and isset($antecedant_personnel)) {

                    echo $antecedant_traite."<br>";
                    echo $habitude."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_personnel."<br>";
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";
                    echo $pathologie."<br>";
                    echo $traitement_en_cours."<br>";
                    echo $date_debut."<br>";
                    echo $dure."<br>";

                } else if (isset($antecedant_famil)) {

                  
                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
                    echo $antecedant_famil."<br>";
                    echo $antecedant_mifa."<br>";
                    echo $antecedant_personnelle."<br>";
                    echo $observation."<br>";

                } else if (isset($habitude)) {

                    echo $adresse_patient."<br>";
                    echo $telephone."<br>";
                    echo $fils."<br>";
                    echo $genre."<br>";
                    echo $groupesangine."<br>";
                    echo $stuation_matrimonial."<br>";
                    echo $ethinie."<br>";
                    echo $poids."<br>";
                    echo $taille."<br>";
                    echo $motif_consultation."<br>";
                    echo $diagnostique."<br>";
                    echo $resultat_clinique."<br>";
                    echo $remarque."<br>";
                    echo $description."<br>";
        
                } else if (isset($antecedant_personnel)) {
                    $consultation_save = $this->insertion_update_simples('UPDATE ticket JOIN patient ON patient.num_patient=ticket.idPatient 
                            join consultation con ON ticket.num_ticket=con.num_ticket
                            SET 
                            patient.genre=:genre,
                            patient.poids_patient=:poids,
                            patient.telephonepat=:telephone,
                            patient.taille_patient=:taille,
                            patient.adresse=:adresse_patient,
                            patient.groupesangine=:groupesangine,
                            patient.stuation_matrimonial=:stuation_matrimonial,
                            patient.fils_de=:fils,
                            patient.ethnie=:ethinie,
                            con.num_medecin=:num_medecin,
                            con.examen_clinic=:examen_clinic,
                            con.motif_consult=:motif_consultation,
                            con.date_consult=now(),
                            con.idpatient=:idpatient,
                            con.resultat_diagnos=:diagnostique,
                            ticket.statut_ticket=:statut_ticke
                            WHERE ticket.num_ticket=:id',
                        [
                            ":adresse_patient"=>$adresse_patient,
                            ":telephone"=>$telephone,
                            ":fils"=>$fils,
                            ":genre"=>$genre,
                            ":groupesangine"=>$groupesangine,
                            ":stuation_matrimonial"=>$stuation_matrimonial,
                            ":ethinie"=>$ethinie,
                            ":poids"=>$poids,
                            ":taille"=>$taille,
                            ":idpatient"=>$idpatient,
                            ":statut_ticke"=>"utiliser",
                            ":motif_consultation"=>$motif_consultation,
                            ":examen_clinic"=>$resultat_clinique,
                            ":diagnostique"=>$diagnostique,
                            ":num_medecin"=>$_SESSION['user_id'],
                            ":id"=>$id
                        ]
                    );
                    $traitement=$this->insertion_update_simples("INSERT INTO antecedent_personnelle (substance,remarque_personnelle,idpatient )   VALUES(:substance,:remarque_personnelle,:idpatient)",
                        [   ":substance"=>$observation,
                            ":remarque_personnelle"=>$antecedant_personnelle,
                            ':idpatient'=>$idpatient
                        ]);


                    if($consultation_save and $traitement){
                        $this->set_flash("La consultation est realisée avec succès ",'success');
                    }

                 

                } else if (isset($antecedant_traite)) {

                    $consultation_save = $this->insertion_update_simples('UPDATE ticket JOIN patient ON patient.num_patient=ticket.idPatient 
                            join consultation con ON ticket.num_ticket=con.num_ticket
                            SET 
                            patient.genre=:genre,
                            patient.poids_patient=:poids,
                            patient.telephonepat=:telephone,
                            patient.taille_patient=:taille,
                            patient.adresse=:adresse_patient,
                            patient.groupesangine=:groupesangine,
                            patient.stuation_matrimonial=:stuation_matrimonial,
                            patient.fils_de=:fils,
                            patient.ethnie=:ethinie,
                            con.num_medecin=:num_medecin,
                            con.examen_clinic=:examen_clinic,
                            con.motif_consult=:motif_consultation,
                            con.date_consult=now(),
                            con.idpatient=:idpatient,
                            con.resultat_diagnos=:diagnostique,
                            ticket.statut_ticket=:statut_ticke
                            WHERE ticket.num_ticket=:id',
                        [
                            ":adresse_patient"=>$adresse_patient,
                            ":telephone"=>$telephone,
                            ":fils"=>$fils,
                            ":genre"=>$genre,
                            ":groupesangine"=>$groupesangine,
                            ":stuation_matrimonial"=>$stuation_matrimonial,
                            ":ethinie"=>$ethinie,
                            ":poids"=>$poids,
                            ":taille"=>$taille,
                            ":idpatient"=>$idpatient,
                            ":statut_ticke"=>"utiliser",
                            ":motif_consultation"=>$motif_consultation,
                            ":examen_clinic"=>$resultat_clinique,
                            ":diagnostique"=>$diagnostique,
                            ":num_medecin"=>$_SESSION['user_id'],
                            ":id"=>$id
                        ]
                    );

                    $traitement=$this->insertion_update_simples("INSERT INTO traitement_en_cours (pathologie,traitement,date_debut,duree,idpatient)   VALUES(:pathologie,:traitement,:date_debut,:duree,:idpatient)",
                        [':pathologie'=>$pathologie,
                        ':traitement'=>$traitement_en_cours,
                        ':date_debut'=>$date_debut,
                        ':duree'=>$dure,
                        ':idpatient'=>$idpatient
                          ]);


                    if($consultation_save and $traitement){
                        $this->set_flash("La consultation est realisée avec succès ",'success');
                    }


                } else{

                    $consultation_save = $this->insertion_update_simples('UPDATE  patient 
                            
                            SET 
                            patient.genre=:genre,
                            
                            patient.telephonepat=:telephone,
                            
                            WHERE num_patient=:id',
                        [

                            ":telephone"=>$telephone,

                            ":genre"=>$genre,


                            ":id"=>$id
                        ]
                    );

                    if($consultation_save){
                        $this->set_flash("La consultation est realisée avec succès ",'success');
                    }


                }

        }else{

            $this->save_input_data();
            return array_push($this->errors,"Les champs ne doivent pas etre vide!! ");
        }
    }
    public function verificationUpdate($champ = [])
    {
        $bdd=$this->bdd();

        if ($this->VerifyFields($champ)){

            $this->e(extract($_POST));


            /*$this->chekErrorsString($nomPatient,5,"Le champ nom doit avoir plus de 4 caracteur");*/
            /*    $this->chekErrorsInt($telephone,"Le champs telephone doit etre un entier");*/

            try{

                $bdd->beginTransaction();



                $this->chekErrorsInt($telephone,8,"Le numero de telephone doit comporter 8 chiffre");

                if(isset($hospitalise)){


                    if($this->table_select('patient','telephonePat',$telephone)){
                        $succes = $this->insertion_update_simples('UPDATE patient pat join ticket ti  on pat.idPatient=ti.idPatient 
                                join  consultation con ON ti.idTicket=con.idTicket

                                SET 
                                 ti.statut=:ticketUtilise,
                                 con.resultatConsultation=:resultatConsultation,
                                 con.idPatient=:idPatient,
                                 con.dateConsultaion=:dateConsultaion,
                                 con.numAgent=:numAgent
                                 where ti.idTicket=:id',[
                            ":ticketUtilise"=>'utiliser',
                            ":idPatient"=>$idPatient,
                            ":numAgent"=>$_SESSION['user_id'],
                            ":resultatConsultation"=>$diagnostique,
                            ":dateConsultaion"=>$dateConsult,
                            ":id"=>$idTicket
                        ]);

                        $hospitalises=$this->insertion_update_simples("UPDATE hospitaliser 
                                                                    SET codesalle=:codesalle,
                                                                    numbrelit=:numbrelit,
                                                                    date_hospitale=:date_hospitale
                                                                      WHERE idConsultation=:id",[":id"=>$idConsultation,":codesalle"=>$salle,":numbrelit"=>$lit,':date_hospitale'=>$dateConsult]);
                        if($hospitalises and $succes){

                            $this->set_flash("La consultation realisés du patient $nomPatient avec succès ",'success');
                        }
                    }
                }else{

                    if($this->table_select('patient','telephonePat',$telephone)){
                        $succes = $this->insertion_update_simples('UPDATE patient pat join ticket ti  on pat.idPatient=ti.idPatient 
                                join  consultation con ON ti.idTicket=con.idTicket

                                SET 
                                 con.resultatConsultation=:resultatConsultation,
                                 con.idPatient=:idPatient,
                                 con.dateConsultaion=:dateConsultaion,
                                 con.numAgent=:numAgent
                                 where ti.idTicket=:id',[

                                ":idPatient"=>$idPatient,
                                ":numAgent"=>$_SESSION['user_id'],
                                ":resultatConsultation"=>$diagnostique,
                                ":dateConsultaion"=>$dateConsult,
                                ":id"=>$idTicket
                        ]);
                        if($succes){

                            $this->set_flash("La consultation realisés du patient $nomPatient avec succès ",'success');
                        }
                    }
                }
                $bdd->commit();

            } catch (Exception $e) {

                $bdd->rollback();

                //on affiche un message d'erreur ainsi que les erreurs
                echo 'Tout ne s\'est pas bien passé, voir les erreurs ci-dessous<br />';
                echo 'Erreur : '.$e->getMessage().'<br />';
                echo 'N° : '.$e->getCode();
                //on arrête l'exécution s'il y a du code après
                exit();
            }
        }else{

            $this->save_input_data();
            return array_push($this->errors,"Les champs ne doivent pas etre vide!! ");
        }
    }

    public function verificationRdv($champ = [])
    {
        $bdd=$this->bdd();

        if ($this->VerifyFields($champ)){

            $this->e(extract($_POST));

            try{

                $bdd->beginTransaction();
                $this->chekErrorsInt($telephone,8,"Le numero de telephone doit comporter 8 chiffre");

                if(isset($hospitalise)){
                    if($this->table_select('patient','telephonePat',$telephone)){
                        $q = $this->insertion_update_simples('UPDATE patient pat join rendezvous re  on pat.idPatient=re.idPatient 
                        join  consultation con ON re.idRendezVous=con.idRendezVous

                        SET 
                        
                         con.resultatConsultation=:resultatConsultation,
                         con.idPatient=:idPatient,
                         con.dateConsultaion=:dateConsultaion,
                         con.numAgent=:numAgent
                         where con.idConsultation=:id',[
                            ":ticketUtilise"=>'utiliser',
                            ":idPatient"=>$idPatient,
                            ":numAgent"=>$_SESSION['user_id'],
                            ":resultatConsultation"=>$diagnostique,
                            ":dateConsultaion"=>$dateConsult,
                            ":id"=>$idRendezVous
                        ]);

                        $hospitalises=$this->insertion_update_simples("UPDATE hospitaliser 
                                                                    SET codesalle=:codesalle,
                                                                    numbrelit=:numbrelit,
                                                                    date_hospitale=:date_hospitale
                                                                      WHERE idConsultation=:id",
                            [":id"=>$idConsultation,":codesalle"=>$salle,":numbrelit"=>$lit,':date_hospitale'=>$dateConsult]);

                        if($hospitalises and $q){

                            $this->set_flash("La consultation realisés du patient $nomPatient avec succès ",'success');
                        }
                    }
                }else{

                    if($this->table_select('patient','telephonePat',$telephone)){
                        $q = $bdd->prepare('UPDATE patient pat join rendezvous re  on pat.idPatient=re.idPatient 
                                join  consultation con ON re.idRendezVous=con.idRendezVous

                                SET 
                                
                                 con.resultatConsultation=:resultatConsultation,
                                 con.idPatient=:idPatient,
                                 con.dateConsultaion=:dateConsultaion,
                                 con.numAgent=:numAgent
                                 where con.idConsultation=:id');

                        $succes=$q->execute([

                            ":idPatient"=>$idPatient,
                            ":numAgent"=>$_SESSION['user_id'],
                            ":resultatConsultation"=>$diagnostique,
                            ":dateConsultaion"=>$dateConsult,
                            ":id"=>$idRendezVous
                        ]);
                        if($succes){
                            $this->set_flash("La consultation realisés du patient $nomPatient avec succès ",'success');
                        }
                    }
                }
                $bdd->commit();
                $this->redirect('Liste_consultations/consultation_rendezvous');
            } catch (Exception $e) {
                $bdd->rollback();

                //on affiche un message d'erreur ainsi que les erreurs
                echo 'Tout ne s\'est pas bien passé, voir les erreurs ci-dessous<br />';
                echo 'Erreur : '.$e->getMessage().'<br />';
                echo 'N° : '.$e->getCode();

                //on arrête l'exécution s'il y a du code après
                exit();
            }
        }else{

            $this->save_input_data();
            return array_push($this->errors,"Les champs ne doivent pas etre vide!! ");
        }
    }

    public function _formAddEditRDV($vlaue=[]){

        if ($this->VerifyFields($vlaue)){
            $this->e(extract($_POST));

            $actif="actif";

            if (count($this->errors) == 0) {

                if (isset($hospitalise)) {

                    // code...

                    $updatConsultation = $this->insertion_update_simples_insert_id("INSERT INTO consultation (dateConsultaion,resultatConsultation,idRendezVous,idPatient,numAgent) 
                        VALUES ( :dateConsultaion,:resultatConsultation,:idRendezVous,:idPatient,:numAgent)",[
                        ":idPatient" => $idPatient,
                        ":numAgent" => $_SESSION['user_id'],
                        ":dateConsultaion" => $dateConsult,
                        ":resultatConsultation" => $diagnostique,
                        ":idRendezVous" => $idRendezVous]);

                    $idConsultation=$updatConsultation['lastInsertId'];

                    $hospitalise_insert=$this->insertion_update_simples("INSERT INTO hospitaliser (idConsultation,codesalle,date_hospitale,numbrelit) 
                      VALUES(:idConsultation,:codesalle,:date_hospitale,:numbrelit)"
                    ,[":idConsultation"=>$idConsultation,":codesalle"=>$salle,":numbrelit"=>$lit,':date_hospitale'=>$dateConsult]);

                    if ($updatConsultation AND $hospitalise_insert) {

                        $q = $this->insertion_update_simples('UPDATE `rendezvous` SET
                                                      effectuer=:effectuer
                                                      WHERE idRendezVous=:idRendezVous ',[
                            ':effectuer'=>$actif,
                            ':idRendezVous'=>$idRendezVous
                        ]);

                        $this->set_flash("La consultation realisés du patient $nomPatient $prenomPatient avec succès ", 'success');
                    }

                } else {

                    $updatConsultation = $this->insertion_update_simples("INSERT INTO consultation (dateConsultaion,resultatConsultation,idRendezVous,idPatient,numAgent) 
                        VALUES ( :dateConsultaion,:resultatConsultation,:idRendezVous,:idPatient,:numAgent)",[
                        ":idPatient" => $idPatient,
                        ":numAgent" => $_SESSION['user_id'],
                        ":dateConsultaion" => $dateConsult,
                        ":resultatConsultation" => $diagnostique,
                        ":idRendezVous" => $idRendezVous]);

                    if ($updatConsultation) {

                        $q = $this->insertion_update_simples('UPDATE `rendezvous` SET
                                                      effectuer=:effectuer
                                                      WHERE idRendezVous=:idRendezVous ',[
                            ':effectuer'=>$actif,
                            ':idRendezVous'=>$idRendezVous
                        ]);

                        $this->set_flash("La consultation realisés du patient $nomPatient $prenomPatient avec succès ", 'success');

                    }
                }

            } else {

                $this->save_input_data();
            }

        }

    }
}


<script type="text/javascript">

    $(document).ready(function () {

        $("#form_consultation").submit(function (event) {
            event.preventDefault();
            var adresse_patient=$("#adresse_patient").val();
            var idpatient=$("#idpatient").val();
            var telephone=$("#telephone").val();
            var fils=$("#fils").val();
            var genre=$("#genre").val();
            var groupesangine=$("#groupesangine").val();
            var stuation_matrimonial=$("#stuation_matrimonial").val();
            var ethinie=$("#ethinie").val();
            var poids=$("#poids").val();
            var taille=$("#taille").val();
            var id=$("#id").val();
            var motif_consultation=$("#motif_consultation").val();
            var diagnostique=$("#diagnostique").val();
            var resultat_clinique=$("#resultat_clinique").val();
            var antecedant_medicaux=$("#antecedant_medicaux").val();
            var antecedant_chirigicale=$("#antecedant_chirigicale").val();
            var antecedant_familiale=$("#antecedant_familiale").val();
            var antecedant_autre=$("#antecedant_autre").val();

            if (adresse_patient!=="" &&  telephone!=="" && id!=="" && fils!=="" && genre !=="" &&  groupesangine!=="" && stuation_matrimonial  !==""  && ethinie !=="" && poids  !=="" && taille !=="" &&
            motif_consultation !=="" &&  diagnostique !=="" && resultat_clinique !=="") {
                $.ajax({
                    url: "<?=ROOT?>/Consultations/Patient",
                    method: 'POST',
                    data:  $(this).serialize(),
                    dataType:"json",
                    success: function (data) {
                        $('.tab-content').before('<div class="alert  alert-pro  alert-success  alert-dismissible"><div class="alert-text"><h4>+data.message+</h4></div><button class="close" data-bs-dismiss="alert"></button></div>')
                        $('#form_consultation')[0].reset();
                    }

                });
            } else {
                alert("Both Fields are Required");
            }
        })
    })
</script>



$updatePatient=$this->insertion_update_simples("UPDATE patient pat 
           INNER JOIN ticket ti ON ti.idPatient=pat.num_patient
           INNER JOIN consultation con ON con.num_ticket=ti.num_ticket
           SET pat.telephonepat=:telephone,
               pat.poids_patient=:poids, 
               pat.genre=:genre,
               pat.taille_patient=:taille,
               pat.groupesangine=:groupesangine,
               pat.fils_de=:fils,
               pat.stuation_matrimonial=:stuation_matrimonial,
               pat.ethinie=:ethinie,
               pat.adresse=:adresse,
               con.date_consult=NOW(),
               con.motif_consult=:motif_consult,
               con.resultat_diagnos=:resultat_diagnos,
               con.idpatient=:idpatient,
               con.antecedant_medicaux=:antecedant_medicaux,
               con.antecedant_chirigicale=:antecedant_chirigicale,
               con.antecedant_familiale=:antecedant_familiale,
               con.antecedant_autre=:antecedant_autre,
               con.num_medecin=:num_medecin,
               con.examen_clinic=:examen_clinic,
               ti.statut_ticket=:ticket_statut   
           WHERE ti.num_ticket=:id",
               [":telephone"=>$telephone,
                   ":poids"=>$poids,
                   ":genre"=>$genre,
                   ":taille"=>$taille,
                   ":groupesangine"=>$groupesangine,
                   ":fils"=>$fils,
                   ":antecedant_medicaux"=>$antecedant_medicaux,
                   ":antecedant_chirigicale"=>$antecedant_chirigicale,
                   ":antecedant_familiale"=>$antecedant_familiale,
                   ":antecedant_autre"=>$antecedant_autre,
                   ":ethinie"=>$ethinie,
                   ":ticket_statut"=>"utiliser",
                   ":stuation_matrimonial"=>$stuation_matrimonial,
                   ":adresse"=>$adresse_patient,
                   ":motif_consult"=> $motif_consultation,
                   ":resultat_diagnos"=> $diagnostique,
                   ":idpatient"=> $idpatient ,
                   ":num_medecin"=>$_SESSION['user_id'],
                   ":examen_clinic"=>$resultat_clinique,
                   ':id'=>$id]);

           if($updatePatient){
               $this->set_flash('Insertion de la consultation','success');
           }







           <!DOCTYPE html>
<html>
<?php $this->view('common/header')?>
<body data-background-color="">
<div class="wrapper">
    <div class="main-header">
        <!-- Logo Header -->

        <!-- End Logo Header -->

        <?php $this->view('common/navbare'); ?>
        <!-- Navbar Header -->


        <!-- End Navbar -->
    </div>

    <!-- Sidebar -->
    <?php $this->view('common/sidebare'); ?>
    <!-- End Sidebar -->



    <!-- contenu principale-->
    <div class="main-panel">

        <div class="content">

            <!-- Row Card No Padding -->

            <div class="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <h4 class="card-title">Voir la liste des examens possibles</h4>
                                    <a class="btn btn-primary btn-round ml-auto" href="<?=ROOT?>/Consultations/liste">
                                        <i class="fas fa-plus"></i>
                                        Lister
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Modal ajout de salle -->
                                <?php $this->view('common/_flash')?>
                                <div class="table-responsive">
                                    <table id="dataTable" class="display table table-striped table-hover" >
                                        <thead>
                                        <tr>
                                            <th width="15%">Nom patient</th>
                                            <th  width="15%">Prenom Patient</th>
                                            <th width="20%">Date de Consultation</th>
                                            <th width="15%">Date expiration</th>
                                            <th>Operation</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <?php foreach  ($tickets as $ticket) : ?>
                                            <?php foreach ($patients as $patient) : ?>
                                                <?php foreach ($consultations as $consultation) : ?>
                                                    <?php  if(isset($_SESSION['role']) and $_SESSION['role']==='supAdmin'||$_SESSION['role']==='admin') : ?>

                                                        <?php if ($patient->num_patient ===  $ticket->idPatient and $consultation->num_ticket===$ticket->num_ticket && $ticket->statut_ticket!==NULL) : ?>

                                                            <tr>
                                                                <td><?=$patient->nom_patient?></td>
                                                                <td><?=$patient->prenom_patient?></td>
                                                                <td><?=$consultation->date_consult ?> </td>
                                                                <td><?=$ticket->date_expire?></td>
                                                                <td>
                                                                    <button class="btn btn-sm dropdown-toggle more-horizontal btn-primary" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                        <span class=" ">action</span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-right" >
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Consultations/edit/<?=$ticket->num_ticket?>">Edit</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Ordonnances/<?=$consultation->num_consult?>">Ordonnance</a>
                                                                        <a class="dropdown-item" href="Certificat.php?id=<?=$patient->num_consult
                                                                        ?>">Certificat</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Analyses/AjoutAnalyse/<?=$ticket->idPatient?>">Analyse</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/AjouterRendezvous/<?=$patient->num_patient?>">Prendre un Rdv</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Consultations/list_consultation_dataille/<?=$patient->num_patient ?>">Plus de
                                                                            detaille en PDF</a>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        <?php endif; ?>
                                                    <?php else : ?>
                                                        <?php if ($patient->idPatient ===  $ticket->idPatient and $consultation->idTicket===$ticket->idTicket && $ticket->statut!==NULL and $consultation->numAgent===$_SESSION['user_id']) : ?>
                                                            <tr>
                                                                <td><?=$patient->nomPatient?></td>
                                                                <td><?=$patient->prenomPatient?></td>
                                                                <td><?=$consultation->dateConsultaion ?> </td>
                                                                <td><?=$consultation->resultatConsultation ?></td>
                                                                <td><?=date('d/m/Y', strtotime($ticket->dateDebut.' +10 day'))?></td>
                                                                <td>
                                                                    <button class="btn btn-sm dropdown-toggle more-horizontal btn-primary" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                        <span class=" ">action</span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-right" >
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Consultations/edit/<?=$ticket->num_ticket?>">Edit</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Ordonnances/<?=$consultation->num_consult?>">Ordonnance</a>
                                                                        <a class="dropdown-item" href="Certificat.php?id=<?=$patient->num_consult
                                                                        ?>">Certificat</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Analyses/AjoutAnalyse/<?=$ticket->idPatient?>">Analyse</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/AjouterRendezvous/<?=$patient->num_patient?>">Prendre un Rdv</a>
                                                                        <a class="dropdown-item" href="<?=ROOT?>/Consultations/list_consultation_dataille/<?=$patient->num_patient ?>">Plus de
                                                                            detaille en PDF</a>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        <?php endif; ?>

                                                    <?php endif; ?>
                                                <?php endforeach; ?>
                                            <?php endforeach; ?>
                                        <?php endforeach; ?>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- TimeLine -->

        </div>
        <?php $this->view('common/foot'); ?>
    </div>
    <!-- End Custom template -->
</div>

<!--   Core JS Files   -->
<?php $this->view('common/footer'); ?>

</body>
</html>

///
ordonnance

<!DOCTYPE html>
<html lang="zxx" class="js">

<?php  $this->view('common/header')?>

<body class="nk-body bg-lighter npc-default has-sidebar ">
<div class="nk-app-root">
    <!-- main @s -->
    <div class="nk-main ">
        <!-- sidebar @s -->
        <?php  $this->view('common/sidebare')?>
        <!-- sidebar @e -->
        <!-- wrap @s -->
        <div class="nk-wrap ">
            <!-- main header @s -->
            <?php $this->view ('common/navbare') ?>
            <!-- main header @e -->
            <!-- content @s -->
            <div class="nk-content ">
                <div class="container-fluid">
                    <div class="nk-content-inner">
                        <div class="nk-content-body">
                            <div class="nk-block-head nk-block-head-sm">
                                <div class="nk-block-between">
                                    <div class="nk-block-head-content">
                                        <h3 class="nk-block-title page-title">Modification d'ordonnance</h3>
                                    </div><!-- .nk-block-head-content -->
                                    <div class="nk-block-head-content">
                                        <div class="toggle-wrap nk-block-tools-toggle">
                                            <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                                            <div class="toggle-expand-content" data-content="pageMenu">
                                                <ul class="nk-block-tools g-3">
                                                    <li>
                                                        <div class="drodown">
                                                            <a href="#" class="dropdown-toggle btn btn-white btn-dim btn-outline-light" data-bs-toggle="dropdown"><em class="d-none d-sm-inline icon ni ni-calender-date"></em><span><span class="d-none d-md-inline">Last</span> 30 Days</span><em class="dd-indc icon ni ni-chevron-right"></em></a>
                                                            <div class="dropdown-menu dropdown-menu-end">
                                                                <ul class="link-list-opt no-bdr">
                                                                    <li><a href="#"><span>Last 30 Days</span></a></li>
                                                                    <li><a href="#"><span>Last 6 Months</span></a></li>
                                                                    <li><a href="#"><span>Last 1 Years</span></a></li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                    <li class="nk-block-tools-opt"><a href="#" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div><!-- .nk-block-head-content -->
                                </div><!-- .nk-block-between -->
                                <br>
                                <?php $this->view('common/_flash')?>
                            </div><!-- .nk-block-head -->
                            <div class="nk-block">

                                <div class="card card-bordered card-preview">
                                    <div class="card-inner">

                                        <div class="preview-block">
                                            <span class="preview-title-lg overline-title">Outlined Preview</span>
                                            <div class="row gy-4">

                                                <form action="" method="post" id="ordonnancedeForme">
                                                    <?php  if(isset($edit)): ?>
                                                        <table class="table datatables table-bordered" >
                                                            <thead>
                                                            <tr class="success">
                                                                <th>Nom du medicament</th>
                                                                <th>Forme et Dosage</th>
                                                                <th>Posoligie</th>
                                                                <th class="col-1">Quantité</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <?php $counter=0; foreach($ordonnances as $ordonnace)  : $counter++ ?>

                                                                <tr>
                                                                    <td>
                                                                        <input type="hidden"  class="form-control idOrdonnance" readonly   name="idOrdonnance[]" VALUE="<?= $edit?>" >
                                                                        <input type="hidden"  class="form-control idContenir" readonly  id="idContenir<?=$counter?>" name="idContenir[]" VALUE="<?= $ordonnace->id_ligneVente ?>" placeholder="Forme du Medoc">
                                                                        <select name="idMedicement[]" class="form-control idMedicement" id="idMedicement<?=$counter?>"  data-category="<?=$counter?>">

                                                                            <option value="<?= $ordonnace->id_lot ?>" selected><?= $ordonnace->dci?></option>
                                                                            <?php foreach($medicaments as $medicament) :?>
                                                                                <?php if($medicament->idMedicament!==$ordonnace->idMedicament) : ?>
                                                                                    <option value="<?= $medicament->idMedicament ?>"><?= $medicament->dci ?></option>
                                                                                <?php endif; ?>
                                                                            <?php endforeach ?>

                                                                        </select>
                                                                    </td>
                                                                    <td>
                                                                        <input type="text"  class="form-control fomMedic0" readonly  id="fomMedic0<?=$counter?>" name="fomMedic0[]" VALUE="<?= $ordonnace->forme.' '.$ordonnace->dosage ?>" placeholder="Forme du Medoc">
                                                                    </td>
                                                                    <td>
                                                                        <textarea type="text"  class="form-control posologie" rows="2"  id="pososlogi<?=$counter?>" name="posologie[]" ><?= $ordonnace->posologie ?></textarea>
                                                                    </td>
                                                                    <td >
                                                                        <input type="text"  class="form-control quantite" id="quantiteMedico<?=$counter?>"  name="quantite[]" value="<?=$ordonnace->quantite_prescite?>" placeholder="La quantité du médicament">
                                                                    </td>
                                                                </tr>
                                                            <?php endforeach ?>
                                                            </tbody>
                                                        </table>
                                                        <br>
                                                        <div align="right" class="">
                                                            <input type="submit" name="submit" class="btn btn-info fa-pull-left" value="Modifier" />
                                                        </div>
                                                    <?php else: ?>
                                                        <div class="row gy-4">
                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <label for="idMedicament">Selection de medicaments</label> <br>
                                                                    <div class="form-control-wrap">
                                                                        <input TYPE='hidden'  class='form-control idConsultation' VALUE='<?=$id?>' NAME='idConsultation'  id='idConsultation'>

                                                                        <select class="form-select js-select2" NAME="idMedicament" ID="idMedicament" data-search="on">
                                                                            <?=$medicaments ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="table-responsive">
                                                                <table class="table  table-bordered" >
                                                                    <thead>
                                                                    <tr class="success">
                                                                        <th CLASS="col">Nom du medicament</th>
                                                                        <th class="col">Forme et Dosage </th>
                                                                        <th class="col">Posoligie</th>
                                                                        <th class="col">Quantité</th>
                                                                        <th class="">Operation</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody class="ajout_tbody" id="ajout_tbody">

                                                                    </tbody>

                                                                </table>
                                                            </div>

                                                            <div class="col-md-12">
                                                                <div class="form-group"  align="right">
                                                                    <input type='submit'  class='btn  btn-primary  ml-auto enregistrer' name='prescrir' value='Prescription'>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    <?php endif; ?>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- .card-preview -->
                            </div><!-- .nk-block -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- content @e -->
            <!-- footer @s -->
            <?php $this->view('common/foot') ?>
            <!-- footer @e -->
        </div>

        <!-- wrap @e -->
    </div>
    <!-- main @e -->
</div>
<!-- app-root @e -->
<!-- select region modal -->

<!-- JavaScript -->
<?php $this->view('common/footer') ?>

<script type="text/javascript">

    $(document).ready(function(){

        var count=0;
        load_panier_data();
        function load_panier_data()
        {
            $.ajax({
                url:"<?=ROOT?>/Ordonnances/dataselectOrdonnance",
                method:"POST",
                dataType:"json",
                success:function(data)
                {
                    $('#ajout_tbody').html(data);
                }
            });
        }

        $(".js-example-basic-single").select2();

        $("#idMedicament").change(function(){
            var idMedicament=$(this).val();
            count++;
            $.ajax({
                url:'<?=ROOT?>/Ordonnances/select_medicament',
                method:"POST",
                data:{idMedicament:idMedicament},
                success:function(data)
                {
                    $("thead").show();
                   load_panier_data();
                    // window.setTimeout(function(){location.reload()},500)
                }
            });

        });

        $(document).on('click', '.remove', function(){

             var last = $('tbody tr').length;
            var id = $(this).attr("id");

            $.ajax({
                url:"<?=ROOT?>/Ordonnances/unset_ordonnances",
                method:"POST",
                data:{id:id},
                success:function(data)
                {

                    load_panier_data();
                    alert("Item has been removed from Cart");
                }
            })
        });

        $(document).on('click', '.edit_remmove', function(){

            var last = $('tbody tr').length;
            var id = $(this).attr("id");

            $.ajax({
                url:"<?=ROOT?>/Commandes/delete",
                method:"POST",
                data:{id:id},
                success:function(data)
                {
                    alert("Item has been removed from Cart");
                }
            })
        });


    });

</script>
<script>
    $(document).on('change', '.idMedicement', function(){
        var category = $(this).val();
        var sub_category_id = $(this).data('category');

        $.ajax({
            url:"<?=ROOT?>/selectData_ajax/fill_select_box",
            method:"POST",
            data:{category:category},
            dataType:'json',
            success:function(data)
            {
                $('#fomMedic0'+ sub_category_id).val(data.forme +" "+data.dosage);
                $('#voiAdmin'+ sub_category_id).val(data.voiAdmin);
            }
        })
    });

</script>
</body>
</html>

//////////



<!DOCTYPE html>
<html lang="zxx" class="js">

<?php  $this->view('common/header')?>

<body class="nk-body bg-lighter npc-default has-sidebar ">
<div class="nk-app-root">
    <!-- main @s -->
    <div class="nk-main ">
        <!-- sidebar @s -->
        <?php  $this->view('common/sidebare')?>
        <!-- sidebar @e -->
        <!-- wrap @s -->
        <div class="nk-wrap ">
            <!-- main header @s -->
            <?php $this->view ('common/navbare') ?>
            <!-- main header @e -->
            <!-- content @s -->
            <div class="nk-content ">
                <div class="container-fluid">
                    <div class="nk-content-inner">
                        <div class="nk-content-body">
                            <div class="nk-block-head nk-block-head-sm">
                                <div class="nk-block-between">
                                    <div class="nk-block-head-content">
                                        <h3 class="nk-block-title page-title">Interface Ticket</h3>
                                    </div><!-- .nk-block-head-content -->
                                    <div class="nk-block-head-content">
                                        <div class="toggle-wrap nk-block-tools-toggle">
                                            <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                                            <div class="toggle-expand-content" data-content="pageMenu">
                                                <ul class="nk-block-tools g-3">
                                                    <li>
                                                        <div class="drodown">
                                                            <a href="#" class="dropdown-toggle btn btn-white btn-dim btn-outline-light" data-bs-toggle="dropdown"><em class="d-none d-sm-inline icon ni ni-calender-date"></em><span><span class="d-none d-md-inline">Last</span> 30 Days</span><em class="dd-indc icon ni ni-chevron-right"></em></a>
                                                            <div class="dropdown-menu dropdown-menu-end">
                                                                <ul class="link-list-opt no-bdr">
                                                                    <li><a href="#"><span>Last 30 Days</span></a></li>
                                                                    <li><a href="#"><span>Last 6 Months</span></a></li>
                                                                    <li><a href="#"><span>Last 1 Years</span></a></li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                    <li class="nk-block-tools-opt"><a href="#" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div><!-- .nk-block-head-content -->
                                </div><!-- .nk-block-between -->
                                <br>
                                <?php $this->view('common/_flash')?>
                            </div><!-- .nk-block-head -->
                            <div class="nk-block">

                                <div class="card card-bordered card-preview">
                                    <div class="card-inner">

                                        <div class="preview-block">
                                            <span class="preview-title-lg overline-title">Outlined Preview</span>
                                            <div class="col-12 mb-5">

                                                <div class="row">
                                                    <div class="col">
                                                        <fieldset class="form-group" >
                                                            <label for="vente-input">N° de la facture</label> <br>
                                                            <select name="vente-input" class="form-control js-example-basic-single  h-25 " id="vente-input" >
                                                                <option>Open this select menu</option>
                                                                <?php foreach ($ordonnances as $item) : ?>
                                                                    <option value="<?=$item->num_ordo ?>"><?="Ordonnance N° ".$item->num_ordo?></option>
                                                                <?php endforeach; ?>
                                                            </select>
                                                        </fieldset>
                                                    </div>
                                                </div>
                                                <form action="" method="post"  id="form_submit">
                                                    <table class="table dataTable">
                                                        <thead>
                                                        <tr class="success">
                                                            <th>Nom du medicament</th>
                                                            <th>Posoligie</th>
                                                            <th>Quantité</th>
                                                            <th>Prix Unitaire</th>
                                                            <th>Montant</th>
                                                            <th></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        </tbody>
                                                        <tfoot>
                                                        <tr>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td>
                                                                <input type="text" class="form-control" readonly placeholder=""  id="total">
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td>
                                                                <input type="submit" name="submit"  class="btn btn-success fa-pull-left btn-lg pull-right submit" value="Valider" />
                                                            </td>
                                                        </tr>
                                                        </tfoot>
                                                    </table>

                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- .card-preview -->
                            </div><!-- .nk-block -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- content @e -->
            <!-- footer @s -->
            <?php $this->view('common/foot') ?>
            <!-- footer @e -->
        </div>

        <!-- wrap @e -->
    </div>
    <!-- main @e -->
</div>
<!-- app-root @e -->
<!-- select region modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="region">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
            <div class="modal-body modal-body-md">
                <h5 class="title mb-4">Select Your Country</h5>
                <div class="nk-country-region">
                    <ul class="country-list text-center gy-2">
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/arg.png" alt="" class="country-flag">
                                <span class="country-name">Argentina</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/aus.png" alt="" class="country-flag">
                                <span class="country-name">Australia</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/bangladesh.png" alt="" class="country-flag">
                                <span class="country-name">Bangladesh</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/canada.png" alt="" class="country-flag">
                                <span class="country-name">Canada <small>(English)</small></span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/china.png" alt="" class="country-flag">
                                <span class="country-name">Centrafricaine</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/china.png" alt="" class="country-flag">
                                <span class="country-name">China</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/french.png" alt="" class="country-flag">
                                <span class="country-name">France</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/germany.png" alt="" class="country-flag">
                                <span class="country-name">Germany</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/iran.png" alt="" class="country-flag">
                                <span class="country-name">Iran</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/italy.png" alt="" class="country-flag">
                                <span class="country-name">Italy</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/mexico.png" alt="" class="country-flag">
                                <span class="country-name">México</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/philipine.png" alt="" class="country-flag">
                                <span class="country-name">Philippines</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/portugal.png" alt="" class="country-flag">
                                <span class="country-name">Portugal</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/s-africa.png" alt="" class="country-flag">
                                <span class="country-name">South Africa</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/spanish.png" alt="" class="country-flag">
                                <span class="country-name">Spain</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/switzerland.png" alt="" class="country-flag">
                                <span class="country-name">Switzerland</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/uk.png" alt="" class="country-flag">
                                <span class="country-name">United Kingdom</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="country-item">
                                <img src="./images/flags/english.png" alt="" class="country-flag">
                                <span class="country-name">United State</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div><!-- .modal-content -->
    </div><!-- .modla-dialog -->
</div><!-- .modal -->
<!-- JavaScript -->
<?php $this->view('common/footer') ?>
<script type="text/javascript">
    $(document).ready(function () {

        $('.submit').hide();
        $('#total').hide();

        $('#vente-input').on('change',function () {
            $('.submit').show();
            $('#total').show();
            var medicament = $(this).val();
            $.ajax({
                url:"<?=ROOT?>/selectData_ajax/paiement_ordo",
                method:"POST",
                data:{medicament:medicament},
                dataType:"json",
                success:function(data)
                {
                    var html = '';
                    for(var count = 0; count < data.length; count++)
                    {
                        html += '<tr>';
                        html +='<td>'+data[count].dci+'</td>';
                        html += '<td>'+data[count].posologie+'</td>';
                        html += '<td>'+data[count].quantite_prescite+'</td>';
                        html += '<td>'+data[count].prix_vente+' CFA</td>';
                        html += '<td><input type="hidden" class="form-control prix_total" value="'+data[count].prix_vente*data[count].quantite_prescite+'">'+data[count].prix_vente*data[count].quantite_prescite+' CFA</td>';
                        html += '<td><input type="checkbox" data-dci="'+data[count].dci+'" data-quantite="'+data[count].quantite_prescite+'" data-posologie="'+data[count].posologie+'"  data-ligneVente="'+data[count].id_ligneVente+'" data-prix_total="'+data[count].prix_vente*data[count].quantite_prescite+'" data-prix_pub="'+data[count].prix_vente+'" class="check_box"  id="'+data[count].id_ligneVente+'" data-ordo="'+data[count].num_ordo+'" data-idmedicament="'+data[count].idMedicament+'"/></td>';
                        html += '</tr>'; }

                    $('tbody').html(html);
                    var sum=0;
                    $('.prix_total').each(function () {
                        var num=$(this).val();
                        if (num!==0){
                            sum+=parseFloat(num);
                        }
                    });
                    $("#total").val(sum +' CFA');
                }
            })
        });

        $(document).on('click', '.check_box', function(){
            var html = '';
            if(this.checked)
            {
                html += '<td><input type="hidden" name="dci[]"  readonly class="form-control" value="'+$(this).data("dci")+'" />'+$(this).data("dci")+'</td>';
                html += '<td><input type="hidden" name="posologie[]"  readonly class="form-control" value="'+$(this).data("posologie")+'" />'+$(this).data("posologie")+'</td>';
                html += '<td><input type="hidden" name="quantiteMedi[]" readonly  class="form-control" value="'+$(this).data("quantite")+'" />'+$(this).data("quantite")+'</td>';
                html += '<td><input type="hidden" name="prix_pub[]"  readonly class="form-control" value="'+$(this).data("prix_vente")+'" />' +
                    '<input type="hidden" name="ordo[]" readonly  class="form-control" value="'+$(this).data("ordo")+'" />'+$(this).data("prix_pub")+' CFA</td>';
                html += '<td><input type="hidden" name="prix_total[]"  readonly class="form-control" value="'+$(this).data("prix_total")+'" />' +
                    '<input type="hidden" name="idmedicament[]"  readonly class="form-control" value="'+$(this).data("idmedicament")+'" />'+$(this).data("prix_total")+' CFA</td>';
                html += '<td><input type="checkbox" data-dci="'+$(this).data('dci')+'" data-quantite="'+$(this).data('quantite')+'" data-posologie="'+$(this).data('posologie')+'"   id="'+$(this).data('ligneVente')+'" data-prix_pub="'+$(this).data('prix_vente')+'" data-prix_total="'+$(this).data('prix_vente')*$(this).data('quantite')+'" class="check_box" checked VALUE="'+$(this).data('idOrdo')+'" data-idmedicament="'+$(this).data('idMedicament')+'"/>' +
                    '<input type="hidden" name="hidden_id[]" value="'+$(this).attr('id')+'" /></td>';
            }else {
                html +='<td>'+$(this).data('dci')+'</td>';
                html += '<td>'+$(this).data('posologie')+'</td>';
                html += '<td>'+$(this).data('quantite')+'</td>';
                html += '<td>'+$(this).data('prix_vente')+ ' CFA</td>';
                html += '<td>'+$(this).data('prix_total')+ ' CFA </td>';
                html += '<td><input type="checkbox" data-dci="'+$(this).data('dci')+'" data-quantite="'+$(this).data('quantite')+'" data-posologie="'+$(this).data('posologie')+'"  data-ligneVente="'+$(this).data('ligneVente')+'" data-prix_pub="'+$(this).data('prix_vente')+'" data-prix_total="'+$(this).data('prix_vente')*$(this).data('quantite')+'" class="check_box"  VALUE="'+$(this).data('idOrdo')+'" data-idmedicament="'+$(this).data('idMedicament')+'"/>' +
                    '<input type="hidden" name="hidden_id[]" value="'+$(this).attr('id')+'" /></td>';
            }

            $(this).closest('tr').html(html);

        });

        $("#form_submit").on('submit',function (event) {
            event.preventDefault();

            if($('.check_box:checked').length > 0)
            {
                $.ajax({
                    url:"<?=ROOT?>/Payement_ord/index",
                    method:"POST",
                    data:$(this).serialize(),
                    dataType:"json",

                    success:function(response)

                    {

                        $('.vente-input').val('');
                        $('#vente-input').before('<div class="container"><div class="alert alert-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><h4>'+response.Vente+'</h4></div></div> <br>')
                    }
                });

                window.setTimeout(function(){location.reload()},2000)
            }

        })


    });

</script>
</body>
</html>




/////////////////////
payement 




<?php
/**
 * Created by PhpStorm.
 * User: SNT
 * Date: 22/01/2023
 * Time: 21:05
 */

class Payement_ordo extends Model
{
    public $errors=[];
    public function InsrtionData($champ=[]){

        $bdd=$this->bdd();

        if ($this->VerifyField($champ)){

            $this->e(extract($_POST));
            $dateVente=date('Y-m-d H:i:s');
            $idOrdos = $ordo;
            $contenir = $hidden_id;
            $idfetch=null;
            $solde=null;
            $stocks=$this->SelectAllData("*",'medicament');

            $montant=null;

            foreach ($stocks as $stock){

                for ($i=0;$i<count($contenir);$i++){

                    if($stock->idMedicament===$idmedicament[$i]){
                        $stock_nouvel=(($stock->stock)-($quantiteMedi[$i]));

                        $stock_modify=$bdd->prepare("UPDATE medicament
                                                 SET
                                                 stock=:stock
                                                  WHERE idMedicament=:id");
                        $stock_modify->execute([':id'=>$idmedicament[$i],":stock"=>$stock_nouvel]);

                        $requeste=$bdd->prepare("UPDATE ligne_vente
                                                 SET
                                                 statut_ordo=:statut,
                                                 qte_vendu=:qte_vendu
                                                  WHERE id_ligneVente=:id");

                        $requeste->execute([':id'=>$contenir[$i],":qte_vendu"=>$quantiteMedi[$i],
                        ":statut"=>"effecuter"]);

                        $montant+=$prix_total[$i];
                    }
                    $this->insertion_update_simples("UPDATE ordonnance
                                                 SET
                                                 dateAchat=:dateAchat,
                                                 montant=:montant
                                                 WHERE num_ordo=:idOrdo",
                                        [':idOrdo'=>$idOrdos[$i],
                                         ":dateAchat"=>$dateVente,
                                         ":montant"=>$montant]);
                }
            }
            if(!empty($_SERVER['HTTP_X_REQUESTED_WITH'])&& $_SERVER['HTTP_X_REQUESTED_WITH']=='XMLHttpRequest'){
                return json_encode(["Vente"=>"Vente realiser avec success"]);
            }
//
//            $mouvement=$bdd->prepare("INSERT INTO mouvements (montant,idOrdo,dateMouvement,typemouvement)
//                                                  VALUES (:montant,:idOrdo,now(),:typemouvement)");
//            $mouvement->execute([":montant"=>$montant,":idOrdo"=>$idOrdos[1],":typemouvement"=>"S"]);



        }else{

            $this->save_input_data();
            return array_push($this->errors,"Les champs ne doivent pas etre vide!! ");
        }

    }

}

